pipeline {
  agent any
  environment {
    VIRTUAL_ENV = "${WORKSPACE}/venv"
  }
  stages {
    stage('Setup') {
      steps {
        script {
          sh "sudo apt-get update"
          sh "sudo apt-get install -y python3-venv"
          sh "python3 -m venv ${VIRTUAL_ENV}"
          sh "source ${VIRTUAL_ENV}/bin/activate && pip3 install -r requirements.txt"
        }
      }
    }
  }
}
